<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>1% Better. Every Day.</title>

<style>
:root {
  --bg-top: #b7dcc9;
  --bg-bottom: #d0e6db;
  --accent: #10b981;
  --accent-soft: #a7f3d0;
  --accent-strong: #047857;
  --text-main: #0f172a;
  --text-subtle: #64748b;
  --card-bg: #ffffff;
  --card-border: rgba(15,23,42,0.06);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont,
  "SF Pro Text", sans-serif;
  background: radial-gradient(circle at top left, var(--bg-top), var(--bg-bottom));
  color: var(--text-main);
  font-size: 15px;
}

.app {
  max-width: 480px;
  margin: 0 auto;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Header */
header {
  padding: 18px 18px 8px;
}

.hero-card {
  background: var(--card-bg);
  border-radius: 28px;
  padding: 18px 20px;
  box-shadow: 0 20px 45px rgba(15,23,42,0.12);
  border: 1px solid var(--card-border);
}

.hero-row {
  display: flex;
  gap: 14px;
  align-items: center;
}

.hero-icon {
  width: 60px;
  height: 60px;
  border-radius: 60px;
  background: radial-gradient(circle at 30% 10%, #fef9c3, #facc15 35%, #22c55e 80%);
  border: 2px solid #fff;
  box-shadow: 0 0 0 3px rgba(34,197,94,0.28),
              0 12px 26px rgba(15,23,42,0.35);
  overflow: hidden;
  position: relative;
}
.hero-icon::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
      radial-gradient(circle at 50% 140%, #0f766e 0, #0f766e 40%, transparent 41%),
      linear-gradient(to top, rgba(15,23,42,0.12), transparent 40%);
}

/* Hero Title */
h1 {
  margin: 0;
  font-size: 24px;
  font-weight: 800;
}

.subtitle {
  font-size: 13px;
  color: var(--text-subtle);
  margin-top: 4px;
}

.hero-meta {
  font-size: 12px;
  margin-top: 12px;
  color: var(--text-subtle);
  display: flex;
  gap: 8px;
}

input[type="date"] {
  padding: 6px 10px;
  border-radius: 10px;
  border: 1px solid var(--card-border);
  font-size: 12px;
}

/* Sections */
main {
  flex: 1;
  padding: 8px 18px 80px;
}

.section-card {
  background: var(--card-bg);
  border-radius: 20px;
  padding: 14px 16px;
  border: 1px solid var(--card-border);
  margin-bottom: 18px;
}

.section-title-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.section-title {
  font-size: 17px;
  font-weight: 600;
}

.section-meta {
  font-size: 12px;
  color: var(--text-subtle);
}

/* Action Card */
.action-card {
  border: 1px solid var(--card-border);
  border-radius: 14px;
  padding: 8px;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 10px;
}

.action-info {
  display: flex;
  gap: 8px;
  align-items: center;
}

.action-icon {
  font-size: 18px;
}

.action-title {
  font-size: 14px;
  font-weight: 600;
}

.action-sub {
  font-size: 12px;
  color: var(--text-subtle);
}

.action-toggle input[type="checkbox"] {
  width: 18px;
  height: 18px;
}

/* Streak Label */
.streak-label {
  font-size: 11px;
  color: var(--accent-strong);
}

/* Calendar + Stats */
.week-summary {
  font-size: 12px;
  margin-bottom: 6px;
}

.week-bars {
  display: flex;
  gap: 4px;
  margin-bottom: 12px;
}

.week-bar {
  width: 20px;
  height: 40px;
  border-radius: 6px;
  background: var(--accent-soft);
}

/* Navigation */
nav {
  position: fixed;
  bottom: 0;
  width: 100%;
  max-width: 480px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--card-bg);
  padding: 10px 6px;
  display: flex;
  justify-content: space-around;
  border-top: 1px solid rgba(0,0,0,0.06);
  border-radius: 20px 20px 0 0;
  box-shadow: 0px -2px 20px rgba(0,0,0,0.06);
}

nav button {
  border: none;
  background: none;
  font-size: 13px;
  color: var(--text-main);
}

.hidden {
  display: none !important;
}
</style>
</head>

<body>
<div class="app">

<header>
<div class="hero-card">
  <div class="hero-row">
    <div class="hero-icon"></div>
    <div>
      <h1>1% Better</h1>
      <div class="subtitle">Tiny actions. Compound results.</div>
    </div>
  </div>

  <div class="hero-meta">
    <span>Today</span>
    <input id="dateInput" type="date"/>
  </div>
</div>
</header>

<main id="screen-home">

<!-- DAILY PROGRESS + HABITS -->
<section class="section-card" id="todaySection">
  <div class="section-title-row">
    <div class="section-title">Power Habits</div>
    <div class="section-meta" id="progressChip">Today: 0%</div>
  </div>
  <div id="actionsList"></div>
</section>

<!-- REHAB BELOW HABITS (as in working v4.3) -->
<section class="section-card" id="rehabSection">
  <div class="section-title-row">
    <div class="section-title">Shoulder Rehab</div>
    <div class="section-meta" id="rehabPhaseLabel">Phase 1</div>
  </div>
  <div class="small" style="margin-bottom:6px;">
    Support your shoulder recovery. Stay consistent. Listen to your body.
  </div>
  <div id="rehabPhases"></div>
</section>

<!-- JOURNAL + REFLECTIONS -->
<section class="section-card">
  <div class="section-title-row">
    <div class="section-title">Reflections</div>
  </div>

  <label class="journal-section-title">Morning Focus</label>
  <textarea id="journalMorning" placeholder="What‚Äôs the ONE thing that matters today?"></textarea>

  <label class="journal-section-title">Evening Reflection</label>
  <textarea id="journalEvening" placeholder="One win or insight from today‚Ä¶"></textarea>
</section>

</main>

<!-- AREA MANAGEMENT SCREEN (hidden by default) -->
<main id="screen-areas" class="hidden">
  <section class="section-card">
    <div class="section-title-row">
      <div class="section-title">Your Habits</div>
      <button id="addHabitBtn" class="nav-btn">+ Add Action</button>
    </div>
    <div id="actionsManage"></div>
  </section>
</main>

<!-- BOTTOM NAV -->
<nav>
  <button id="navHome">üè† Home</button>
  <button id="navAreas">üìã Actions</button>
</nav>

<script>
// ---------------- STORAGE + STATE ----------------

var STORAGE_KEY = "onepct_v43_focus";

function loadState() {
  try {
    var s = JSON.parse(localStorage.getItem(STORAGE_KEY));
    if (s) return s;
  } catch(e){}
  return {
    version: "4.3.0",
    currentDate: new Date().toISOString().slice(0,10),
    days: {},
    actions: []
  };
}

var state = loadState();
var currentDate = state.currentDate;

function saveState() {
  state.currentDate = currentDate;
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e){}
}

function ensureDay(date) {
  if (!state.days[date]) {
    state.days[date] = { done:{}, morning:"", evening:"", rehab:{} };
  }
  return state.days[date];
}

var today = ensureDay(currentDate);
var expandedSubFocus = {};

// ---------------- ACTIONS ----------------

var DEFAULT_ACTIONS = [
  { id:"a1", area:"Health", sub:"Cold Plunge", title:"2-min cold plunge", favorite:true },
  { id:"a2", area:"Breath", sub:"Wim Hof", title:"3 rounds breath", favorite:true },
  { id:"a3", area:"Mobility", sub:"Stretch", title:"5-min stretch", favorite:false },
  { id:"a4", area:"Spirit", sub:"Meditate", title:"10-min sit", favorite:true },
  { id:"a5", area:"Family", sub:"Anya", title:"1 meaningful check-in", favorite:true }
];

if (!state.actions.length) {
  state.actions = JSON.parse(JSON.stringify(DEFAULT_ACTIONS));
  saveState();
}

// ---------------- PROGRESS ----------------

function computeStreak(actionId) {
  var streak = 0;
  var cursor = new Date(currentDate);

  while (true) {
    var key = cursor.toISOString().slice(0,10);
    var day = state.days[key];
    if (!day || !day.done[actionId]) break;
    streak++;
    cursor.setDate(cursor.getDate() - 1);
  }
  return streak;
}

function renderProgress(day) {
  var total = state.actions.length;
  var done = state.actions.filter(a => day.done[a.id]).length;
  var pct = total ? Math.round(done/total*100) : 0;
  document.getElementById("progressChip").textContent =
    "Today: " + pct + "% (" + done + "/" + total + ")";
}

// ---------------- ACTION LIST ----------------

function toggleAction(actionId) {
  var day = ensureDay(currentDate);
  day.done[actionId] = !day.done[actionId];
  saveState();
  render();
}

function renderActionsToday(day) {
  var list = document.getElementById("actionsList");
  list.innerHTML = "";

  state.actions.forEach(a => {
    var row = document.createElement("div");
    row.className = "action-card";

    var info = document.createElement("div");
    info.className = "action-info";
    info.innerHTML = `
      <span class="action-icon">üî•</span>
      <div>
        <div class="action-title">${a.title}</div>
        <div class="action-sub">${a.sub || ""}</div>
        <div class="streak-label">${computeStreak(a.id)}d streak</div>
      </div>
    `;

    var box = document.createElement("input");
    box.type = "checkbox";
    box.checked = !!day.done[a.id];
    box.addEventListener("change", () => toggleAction(a.id));

    var toggle = document.createElement("div");
    toggle.className = "action-toggle";
    toggle.appendChild(box);

    row.appendChild(info);
    row.appendChild(toggle);
    list.appendChild(row);
  });
}

// ---------------- JOURNAL ----------------

function renderJournal(day) {
  document.getElementById("journalMorning").value = day.morning || "";
  document.getElementById("journalEvening").value = day.evening || "";
}

document.getElementById("journalMorning").addEventListener("input", (e)=>{
  ensureDay(currentDate).morning = e.target.value;
  saveState();
});

document.getElementById("journalEvening").addEventListener("input", (e)=>{
  ensureDay(currentDate).evening = e.target.value;
  saveState();
});

// ---------------- REHAB (Phase always visible in v4.3) ----------------

var REHAB_PHASES = {
  "Phase 1": ["Pendulums 2√ó10", "Scap squeezes 2√ó10", "Table slides 2√ó8"],
  "Phase 2": ["Wand flexion 2√ó10", "Wall slides 2√ó8"],
};

state.rehabPhase = state.rehabPhase || "Phase 1";

function renderRehab(day) {
  document.getElementById("rehabPhaseLabel").textContent = state.rehabPhase;

  var wrap = document.getElementById("rehabPhases");
  wrap.innerHTML = "";

  REHAB_PHASES[state.rehabPhase].forEach((title, i) => {
    var id = state.rehabPhase+"-"+i;
    var checked = day.rehab[id];

    var div = document.createElement("div");
    div.className = "action-card";
    div.innerHTML = `<div>${title}</div>`;

    var box = document.createElement("input");
    box.type = "checkbox";
    box.checked = !!checked;
    box.addEventListener("change", () => {
      day.rehab[id] = !day.rehab[id];
      saveState();
      render();
    });

    div.appendChild(box);
    wrap.appendChild(div);
  });
}

// ---------------- NAVIGATION ----------------

var homeScreen = document.getElementById("screen-home");
var areasScreen = document.getElementById("screen-areas");

document.getElementById("navHome").addEventListener("click", ()=>{
  homeScreen.classList.remove("hidden");
  areasScreen.classList.add("hidden");
});

document.getElementById("navAreas").addEventListener("click", ()=>{
  areasScreen.classList.remove("hidden");
  homeScreen.classList.add("hidden");
  renderManageActions();
});

// ---------------- MANAGE ACTIONS ----------------

function renderManageActions() {
  var wrap = document.getElementById("actionsManage");
  wrap.innerHTML = "";

  state.actions.forEach(a => {
    var div = document.createElement("div");
    div.className = "action-card";
    div.innerHTML = `<div>${a.area || ""} ‚Äî ${a.title}</div>`;
    wrap.appendChild(div);
  });
}

// ---------------- DATE CHANGE ----------------

document.getElementById("dateInput").value = currentDate;

document.getElementById("dateInput").addEventListener("change", (e)=>{
  currentDate = e.target.value;
  ensureDay(currentDate);
  saveState();
  render();
});

// ---------------- MASTER RENDER ----------------

function render() {
  var day = ensureDay(currentDate);
  renderActionsToday(day);
  renderProgress(day);
  renderRehab(day);
  renderJournal(day);
}

render();
</script>

</div>
</body>
</html>
